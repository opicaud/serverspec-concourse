#!/usr/bin/env ruby

require 'json'
require 'fileutils'



sSource = STDIN.read
source = JSON.parse(sSource)
host = source["source"]["host"]
user = source["source"]["user"]
ssh_key = source["source"]["ssh_key"]
tests = source["params"]["tests"]

sourceDir = ARGV[0]

hostDir = "/serverspec/spec/" + host
STDERR.puts hostDir

FileUtils.mkdir_p hostDir


listeDir = `ls -aRl /serverspec`
STDERR.puts listeDir

testFile = File.join(sourceDir, tests)
testContent = File.read(testFile)


ret = {
    "version": {"host": host, "user": user},

    "metadata": [
        {"name": "a-metadata", "value":"out"}
    ]
}

puts ret.to_json
